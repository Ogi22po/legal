#!/bin/bash

remote='legal.pecina.cz'
user="legal"
opts='-vrlpthHzx --delete'
files='legal collect fonts activate manage.py requirements.txt'
exc='.* *.pyc *~ *.po secrets.py static/ migrations/ __pycache__/ #*'
basedir='/var/www/django/legal'

./make-static

excludes=''
for e in $exc; do
    excludes="--exclude $e $excludes"
done

rsync $opts $excludes $files $user@$remote:$basedir/ || exit 1

if [ -e secrets.py ]; then
    rsync $opts secrets.py $user@$remote:$basedir/legal/ || exit 1
fi

ssh $user@$remote 'source activate && pip install -q -r requirements.txt' || exit 1

ssh $user@$remote 'touch legal/wsgi.py' || exit 1
