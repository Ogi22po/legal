# .travis.yml

language: "python"

sudo:  "required"

python:
  - "3.5"
  - "3.6"
  - "nightly"

services:
  - "mysql"

addons:
  apt:
    packages:
    - "ruby-dev"

env:
  global:
    - "DBUSER=root"
  matrix:
    - "DJANGO_VERSION=requirements"
    - "DJANGO_VERSION=nightly"

before_install:
  - "sudo apt-get -y autoremove libtidy-0.99-0 tidy"
  - "wget https://github.com/htacg/tidy-html5/releases/download/5.4.0/tidy-5.4.0-64bit.deb"
  - "sudo dpkg -i tidy-*.deb"
  - "sudo locale-gen cs_CZ"
  - "gem install compass"
  - |
    if [ "$DJANGO_VERSION" == nightly ]; then
        pip install git+https://github.com/django/django.git
        pip install -r <(cat requirements.txt | grep -v -e '^Django==')
    else
        pip install -r requirements.txt
    fi

install:
  - "./dosass"
  - "./manage.py collectstatic --noinput --ignore='*.scss' --ignore='*.map'" 

script:
  - "./manage.py test --failfast && ./manage.py test --reverse --failfast"
